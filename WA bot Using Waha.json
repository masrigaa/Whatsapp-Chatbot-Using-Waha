{
  "name": "My workflow 3",
  "nodes": [
    {
      "parameters": {},
      "type": "@devlikeapro/n8n-nodes-waha.wahaTrigger",
      "typeVersion": 202502,
      "position": [
        -464,
        -128
      ],
      "id": "fb6c381b-743c-47b7-96a9-c0a6d8b796f6",
      "name": "WAHA Trigger",
      "webhookId": "7da19413-097a-4acf-a401-6ae3882794d6"
    },
    {
      "parameters": {
        "resource": "Chatting",
        "operation": "Send Text",
        "session": "={{ $('WAHA Trigger').item.json.session }}",
        "chatId": "={{ $('WAHA Trigger').item.json.payload.from }}",
        "text": "={{ $json.text }}",
        "requestOptions": {}
      },
      "type": "@devlikeapro/n8n-nodes-waha.WAHA",
      "typeVersion": 202502,
      "position": [
        1056,
        928
      ],
      "id": "b5efbf6b-7ace-48de-a0a2-e20887178da2",
      "name": "Send a text message"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "==User: {{ $json.payload.from }}\nnotifyName: {{ $json.payload._data.notifyName }}\nQuestion/Prompt: {{ $json.payload.body }}",
        "options": {
          "systemMessage": "=You are a helpful assistant named Olivia Carla. \nYou may refer to yourself as \"Olivia\" or \"Carla\". \nYou were created by Asla Fikri. \n\n‚ö†Ô∏è Rules of Identity:\n- Never say you were created or trained by Google.\n- If asked who created you, say you were developed by Asla Fikri and share:\n  - GitHub: https://github.com/masrigaa\n  - LinkedIn: https://www.linkedin.com/in/aslamul-fikri-alfirdausi\n\n‚ö†Ô∏è Rules of Responses:\n- Always answer in the same language as the user‚Äôs question.\n- Never reference or mention any YouTube channel, podcast, or unrelated external content (e.g., \"Presting Podcast\") unless specifically asked.\n- You must always reply in valid JSON array format, never plain text (except when answering \"who created you\").\n- If the answer includes code, wrap the code in triple backticks inside its own JSON object.\n-You must ONLY output a valid JSON array. \n-All objects must be closed properly with commas and braces. \n-Do not cut the answer short. \nIf unsure, output `[{\"text\":\"error\"}]`.\n- if notifyName = asla call him darling when answer in english or sayang when answer with indonesia but if not dont do it.\n\nüìå Example Format:\n[\n  { \"text\": \"penjelasan awal\" },\n  { \"text\": \"```python\\nprint('Hello')\\n```\" },\n  { \"text\": \"penjelasan setelah kode\" }\n]\n\n‚öôÔ∏è Extra Capabilities:\n1. Image Generation:\n   - If the user wants an image, they must start with `gambar:` in their prompt.\n   - Reply with JSON as usual, embedding only the image description or result.\n2. Link Preview:\n   - When generating a summary or explanation for any link (YouTube, X/Twitter, TikTok, GIF, image, PDF, webpage, or other file):\n    - First, determine the type of content.\n    - For files (GIF, image, PDF, etc.):\n        - Include file type\n        - Include title/filename, size, dimensions, or duration if available\n        - Include thumbnail or preview URL if available\n        - Briefly explain what the file shows\n    - For videos, articles, or webpages:\n        - Include title, description, image, and URL\n        - Present all information as human-readable text\n    - Instead of including raw JSON inside the text, format the preview as human-readable:\n        Title: <title>\n        Description: <description>\n        Image: <image>\n        URL: <url>\n   - Keep everything human-friendly, properly line-broken, and easy to read.\n   - Always output a valid JSON array with objects containing only \"text\".\n   - Do NOT wrap any text in ```json``` or code blocks."
        }
      },
      "id": "58762b9c-58ec-4890-8dae-bd11b159d4d5",
      "name": "WA AI Response Agent",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        352,
        912
      ],
      "typeVersion": 1.8,
      "retryOnFail": true,
      "waitBetweenTries": 100,
      "maxTries": 2
    },
    {
      "parameters": {
        "jsCode": "let raw = $input.first().json.output || \"\";\n\n// Bersihkan block ```json\nraw = raw.replace(/```json/g, \"\").replace(/```/g, \"\").trim();\n\n// Coba parse langsung dulu\ntry {\n  let parsed = JSON.parse(raw);\n  return Array.isArray(parsed) ? parsed.map(x => ({ json: x })) : [{ json: parsed }];\n} catch (e) {\n  // Kalau gagal, coba \"fix\" dengan cara sederhana:\n  // 1. Tambah ']' kalau array kebuka\n  if (raw.trim().startsWith(\"[\") && !raw.trim().endsWith(\"]\")) {\n    raw = raw + \"]\";\n  }\n  // 2. Tambah '}' kalau object kebuka\n  if (raw.trim().startsWith(\"{\") && !raw.trim().endsWith(\"}\")) {\n    raw = raw + \"}\";\n  }\n\n  try {\n    let parsed = JSON.parse(raw);\n    return Array.isArray(parsed) ? parsed.map(x => ({ json: x })) : [{ json: parsed }];\n  } catch (e2) {\n    // Kalau tetap gagal, fallback ke teks mentah\n    return [{ json: { text: raw, error: \"Invalid JSON\" } }];\n  }\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        656,
        912
      ],
      "id": "e7ea0c0c-a16a-4cad-806d-c46f6dc7a0dc",
      "name": "JSON Parse",
      "retryOnFail": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        832,
        912
      ],
      "id": "6b39bb03-4326-4254-a56f-712b88de9918",
      "name": "Loop Over Items"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "loose",
            "version": 2
          },
          "conditions": [
            {
              "id": "d02739c7-f540-497a-8e39-681ce6458ecb",
              "leftValue": "={{ $json.payload.body }}",
              "rightValue": "gambar:",
              "operator": {
                "type": "string",
                "operation": "contains"
              }
            }
          ],
          "combinator": "and"
        },
        "looseTypeValidation": true,
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -32,
        -128
      ],
      "id": "72a0ff23-ba46-4a60-8dac-7e7c774c0dc1",
      "name": "If"
    },
    {
      "parameters": {
        "jsCode": "const full = $input.first().json.payload.body || '';\nconst prompt = full.replace('gambar:', '').trim();\nreturn [{ json: {\n  prompt: prompt,\n  userId: $input.first().json.payload._data.notifyName\n}}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        176,
        -144
      ],
      "id": "13021600-94d7-4ff4-9c95-b26e47171a83",
      "name": "Code"
    },
    {
      "parameters": {
        "assignments": {
          "assignments": [
            {
              "id": "4e04fec4-441e-45f7-acea-0017a4b5c104",
              "name": "model",
              "type": "string",
              "value": "flux"
            },
            {
              "id": "aa80cd68-1c82-4032-b1d7-e098856eec38",
              "name": "width",
              "type": "string",
              "value": "1080"
            },
            {
              "id": "da6d305f-aece-49bd-ae02-52df59915c60",
              "name": "height",
              "type": "string",
              "value": "1920"
            }
          ]
        },
        "options": {}
      },
      "id": "ec70690e-2fdf-4797-98a7-38160ac668f2",
      "name": "Fields - Set Values",
      "type": "n8n-nodes-base.set",
      "position": [
        368,
        -144
      ],
      "typeVersion": 3.4
    },
    {
      "parameters": {
        "jsCode": "function cleanAndExtractJSON(response) {\n    try {\n        const result = {\n            image_prompt: []\n        };\n\n        const lines = response.split('\\n');\n        let currentPrompt = '';\n\n        for (const line of lines) {\n            if (line.includes('\"prompt\":')) {\n                if (currentPrompt) {\n                    result.image_prompt.push(currentPrompt.trim());\n                }\n                currentPrompt = line.split('\"prompt\":')[1].trim();\n            }\n        }\n\n        if (currentPrompt) {\n            result.image_prompt.push(currentPrompt.trim());\n        }\n\n        return { json: result };\n        \n    } catch (error) {\n        return { \n            json: {\n                image_prompt: []\n            }\n        };\n    }\n}\n\nconst response = $input.first().json.output;\nreturn cleanAndExtractJSON(response);"
      },
      "id": "709efbd6-c3ad-458b-8d47-e58e05e2cc5c",
      "name": "Code - Clean Json",
      "type": "n8n-nodes-base.code",
      "position": [
        800,
        -144
      ],
      "executeOnce": false,
      "typeVersion": 2,
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "return $input.first().json.image_prompt.map(prompt => ({\n  json: {\n    body: {\n      prompt: prompt,\n  \"image_size\": {\n    \"width\": $('Fields - Set Values').first().json.width,\n    \"height\": $('Fields - Set Values').first().json.height\n  },\n  \"num_inference_steps\": 12,\n  \"guidance_scale\": 3.5,\n  \"num_images\": 1,\n  \"enable_safety_checker\": true,\n}\n    }\n  }\n));"
      },
      "id": "7d9b6d60-f49e-4778-9920-5de5b8ff6df3",
      "name": "Code - Get Prompt",
      "type": "n8n-nodes-base.code",
      "position": [
        976,
        -144
      ],
      "typeVersion": 2,
      "alwaysOutputData": true
    },
    {
      "parameters": {
        "jsCode": "for (let i = 0; i < items.length; i++) {\n  items[i].json.fileName = `images_${(i + 1).toString().padStart(3, '0')}.png`;\n}\nreturn items;"
      },
      "id": "529747dc-7f22-46bf-b0a8-ba4c662d4e2d",
      "name": "Code - Set Filename",
      "type": "n8n-nodes-base.code",
      "position": [
        1152,
        -144
      ],
      "typeVersion": 2
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "={{ $('Code').item.json.prompt }}",
        "hasOutputParser": true,
        "options": {
          "systemMessage": "=You are an AI image‚Äëprompt creation expert. Please create a post using the following JSON format:\nAI Image Generation Prompt Guidelines:\nObjective\nCreate highly realistic, high‚Äêquality images\nEnsure the image content faithfully conveys the spirit of the original text\nIntegrate short text (10‚Äì20 characters) naturally into the image\nMaintain consistency and professionalism\n\nStandard Prompt Structure\n[Main Scene] | [Key Elements] | [Text Integration] | [Lighting & Atmosphere] | [Technical Parameters] | [Style Parameters]\n\nComponent Breakdown\n1. Main Scene (Weight ::8)\nDescribe the primary setting in line with the content.\nExamples:\nTech news: ‚Äúmodern tech office setting, minimalist workspace‚Äù\nEconomy news: ‚Äúprofessional financial district, corporate environment‚Äù\nEducation news: ‚Äúmodern classroom, advanced learning environment‚Äù\n\n2. Key Elements (Weight ::8)\nList the main visual elements required.\nExamples:\n‚Äúlarge HD display showing text ‚ÄòAI Ethics‚Äô in modern typography‚Äù\n‚Äúprofessional people in business attire discussing around interactive screen‚Äù\n‚Äúdetailed infographic elements floating in augmented reality style‚Äù\n\n3. Text Integration (Weight ::7)\nHow to display text within the image:\ntext elements | elegant typography, clear readable text, integrated naturally into scene ::7\n\n4. Lighting & Atmosphere (Weight ::7)\nlighting | cinematic dramatic lighting, natural ambient light, professional studio setup ::7\nbackground | depth of field blur, clean professional environment ::6\n\n5. Technical Parameters\nparameters | 8k resolution, hyperrealistic, photorealistic quality, octane render, cinematic composition --ar 16:9\nsettings | sharp focus, high detail, professional photography --s 1000 --q 2\nComplete Examples\nExample¬†1: AI Ethics News\nprofessional tech conference room | large display showing \"AI Ethics Now\" in modern typography, group of diverse executives in discussion ::8 | clean modern workspace, glass walls, tech atmosphere ::7 | cinematic lighting, natural window light ::7 | 8k resolution, hyperrealistic quality, octane render --ar 16:9 --s 1000 --q 2\nExample¬†2: Financial Market News\nmodern stock exchange environment | giant LED wall showing \"Market Alert\" in bold typography, professional traders in action ::8 | dynamic financial data visualization, sleek modern interior ::7 | dramatic lighting, blue-tinted atmosphere ::7 | 8k resolution, photorealistic quality --ar 16:9 --s 1000 --q 2\n\nAdditional Parameters\n--chaos [0‚Äì100]: Adjust randomness\n--stylize [0‚Äì1000]: Degree of stylization\n--seed [number]: Ensure consistency across generations\n--niji: Optimized for Asian‚Äêstyle aesthetics\n--v 5.2: Use the latest model version\n\nImportant Notes\nText in Image\nKeep it short and legible\nUse professional fonts\nIntegrate naturally into the scene\n\nComposition\nFollow the rule of thirds\nEnsure a clear focal point\nBalance text and imagery\n\nColor\nMatch a professional tone\nProvide sufficient contrast for readability\nMaintain visual consistency\n\nTechnical Details\nAlways use high resolution (8k)\nEnsure professional lighting\nOptimize for sharpness and detail\n\nCommon Pitfalls to Avoid\nOverly generic prompts\nMissing text‚Äêintegration guidance\nFailing to specify composition rules\nOmitting key technical parameters\n\nThe structure is:\n{\n  prompt_image {prompt : \"\" , ...}\n}"
        }
      },
      "id": "93eebb55-2b93-41c7-a66d-b64eb5b5c51c",
      "name": "AI Agent - Create Image From Prompt",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        512,
        -144
      ],
      "typeVersion": 1.7,
      "retryOnFail": true
    },
    {
      "parameters": {
        "modelName": "models/gemini-2.5-flash-preview-05-20",
        "options": {
          "maxOutputTokens": 65536,
          "temperature": 0.5,
          "topK": 40,
          "topP": 1,
          "safetySettings": {
            "values": [
              {
                "category": "HARM_CATEGORY_HARASSMENT",
                "threshold": "BLOCK_NONE"
              },
              {
                "category": "HARM_CATEGORY_HATE_SPEECH",
                "threshold": "BLOCK_NONE"
              },
              {
                "category": "HARM_CATEGORY_SEXUALLY_EXPLICIT",
                "threshold": "BLOCK_NONE"
              },
              {
                "category": "HARM_CATEGORY_DANGEROUS_CONTENT",
                "threshold": "BLOCK_NONE"
              }
            ]
          }
        }
      },
      "id": "cda0414e-518d-445f-8cb5-9e7f306b8097",
      "name": "Google Gemini Chat Model1",
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "position": [
        512,
        32
      ],
      "typeVersion": 1
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst results = [];\n\nfor (let i = 0; i < items.length; i++) {\n  const item = items[i];\n  \n  // Cek jika HTTP request berhasil\n  if (item.json && item.json.url) {\n    results.push({\n      json: {\n        imageUrl: item.json.url,\n        fileName: item.json.fileName || `image_${i + 1}.png`,\n        success: true\n      }\n    });\n  } else {\n    // Jika gagal, buat URL langsung dari Pollinations\n    const prompt = $('Code - Get Prompt').item.json.body.prompt;\n    const width = $('Fields - Set Values').item.json.width;\n    const height = $('Fields - Set Values').item.json.height;\n    \n    const directUrl = `https://image.pollinations.ai/prompt/${encodeURIComponent(prompt)}?width=${width}&height=${height}&model=flux&seed=42&nologo=true`;\n    \n    results.push({\n      json: {\n        imageUrl: directUrl,\n        fileName: `image_${i + 1}.png`,\n        success: true\n      }\n    });\n  }\n}\n\nreturn results;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1152,
        64
      ],
      "id": "c96ff364-c938-497b-aeb7-ed8843285cbb",
      "name": "Handle Respons"
    },
    {
      "parameters": {
        "jsCode": "const items = $input.all();\nconst validImages = [];\n\nfor (let item of items) {\n  if (item.json && item.json.url) {\n    validImages.push(item.json);\n  }\n}\n\nif (validImages.length === 0) {\n  return [{\n    json: {\n      error: \"Gagal membuat gambar\",\n      answer: `<@{{ $json.body.userId }}> Maaf, gagal membuat gambar. Silakan coba lagi.`\n    }\n  }];\n}\n\nreturn validImages;"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        976,
        64
      ],
      "id": "3003dab9-2ac9-4437-b6e9-783d4535a402",
      "name": "Error Handler"
    },
    {
      "parameters": {
        "url": "=https://image.pollinations.ai/prompt/ {{ $('Code - Get Prompt').item.json.body.prompt }}",
        "sendQuery": true,
        "specifyQuery": "json",
        "jsonQuery": "={\n  \"width\": {{ $('Fields - Set Values').item.json.width }},\n  \"height\": {{ $('Fields - Set Values').item.json.height }},\n  \"model\": \"{{ $('Fields - Set Values').item.json.model }}\",\n  \"seed\": 42,\n  \"nologo\": true\n}",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Content-Type",
              "value": "application/json"
            },
            {
              "name": "Accept",
              "value": "application/json"
            }
          ]
        },
        "options": {}
      },
      "id": "f5020de5-cd70-4411-a670-ff6fb6b4e977",
      "name": "Create Image",
      "type": "n8n-nodes-base.httpRequest",
      "position": [
        800,
        64
      ],
      "retryOnFail": true,
      "typeVersion": 4.2,
      "alwaysOutputData": true,
      "waitBetweenTries": 5000
    },
    {
      "parameters": {
        "url": "https://tinyurl.com/api-create.php",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "=url",
              "value": "={{ $json.imageUrl }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequest",
      "typeVersion": 4.2,
      "position": [
        800,
        272
      ],
      "id": "745ed5c5-cd8f-42b1-90b7-c13d38ca5ae8",
      "name": "Change Link To Be Sort"
    },
    {
      "parameters": {
        "resource": "Chatting",
        "operation": "Send Text",
        "session": "={{ $('WAHA Trigger').item.json.session }}",
        "chatId": "={{ $('WAHA Trigger').item.json.payload.from }}",
        "text": "={{ $json.answer }}",
        "requestOptions": {}
      },
      "type": "@devlikeapro/n8n-nodes-waha.WAHA",
      "typeVersion": 202502,
      "position": [
        1152,
        272
      ],
      "id": "9b879425-c092-437c-ae69-87a851cdbb8e",
      "name": "Send a text message1"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "e6e84476-12f2-45e4-ab5a-5f28dfafd4b2",
              "leftValue": "={{$json.payload.timestamp * 1000}}",
              "rightValue": "={{$now.toMillis() - (60 * 1000)}}",
              "operator": {
                "type": "number",
                "operation": "gt"
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        -240,
        -112
      ],
      "id": "87174df4-0dea-4209-b711-c750cf722911",
      "name": "If1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.toolSerpApi",
      "typeVersion": 1,
      "position": [
        544,
        1120
      ],
      "id": "90b75f28-9f0e-4377-a35b-6f70f8048a8d",
      "name": "SerpAPI"
    },
    {
      "parameters": {
        "toolDescription": "Use this tool to retrieve jokes",
        "url": "https://v2.jokeapi.dev/joke/",
        "sendQuery": true,
        "queryParameters": {
          "parameters": [
            {
              "name": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Name', ``, 'string') }}",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        640,
        1120
      ],
      "id": "fc23dd2a-2e27-42d4-8534-10b7a56eb130",
      "name": "Joke API"
    },
    {
      "parameters": {
        "toolDescription": "Use this tool to read about the joke api documentation, so that you can filter queries to the api based on the user prompt.",
        "url": "https://v2.jokeapi.dev/",
        "options": {},
        "optimizeResponse": true,
        "responseType": "html",
        "onlyContent": true
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        640,
        1216
      ],
      "id": "e398f25b-7e5c-4cb9-8a0e-521dc4c819b6",
      "name": "API docs"
    },
    {
      "parameters": {
        "sessionIdType": "customKey",
        "sessionKey": "={{ $('If').item.json.payload.from }}",
        "contextWindowLength": 20
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        448,
        1088
      ],
      "id": "e10c532d-3be1-468b-a09b-04b851a32148",
      "name": "Simple Memory"
    },
    {
      "parameters": {
        "conditions": {
          "options": {
            "caseSensitive": true,
            "leftValue": "",
            "typeValidation": "strict",
            "version": 2
          },
          "conditions": [
            {
              "id": "139ca7c1-1ee2-4a48-88f5-402d5b4afbcc",
              "leftValue": "={{ $json.payload.hasMedia }}",
              "rightValue": "",
              "operator": {
                "type": "boolean",
                "operation": "true",
                "singleValue": true
              }
            }
          ],
          "combinator": "and"
        },
        "options": {}
      },
      "type": "n8n-nodes-base.if",
      "typeVersion": 2.2,
      "position": [
        144,
        512
      ],
      "id": "d7b1367b-39fe-4f62-9542-b26924b7a88d",
      "name": "If2"
    },
    {
      "parameters": {
        "resource": "image",
        "operation": "analyze",
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "text": "={{ $json.body }}",
        "imageUrls": "={{ $json.mediaUrl }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        784,
        448
      ],
      "id": "3862f25c-9645-4eb5-a6cf-f9aa3e50c6a7",
      "name": "Analyze image",
      "retryOnFail": true
    },
    {
      "parameters": {
        "resource": "Chatting",
        "operation": "Send Text",
        "session": "={{ $('WAHA Trigger').item.json.session }}",
        "chatId": "={{ $('WAHA Trigger').item.json.payload.from }}",
        "text": "={{ $json.text }}",
        "requestOptions": {}
      },
      "type": "@devlikeapro/n8n-nodes-waha.WAHA",
      "typeVersion": 202502,
      "position": [
        1760,
        608
      ],
      "id": "b8e9e09f-432f-4460-bd13-8bb4720dd676",
      "name": "Send a text message2"
    },
    {
      "parameters": {
        "promptType": "define",
        "text": "==User: {{ $('If1').item.json.payload.from }}\nnotifyName: {{ $('If1').item.json.payload._data.notifyName }}\nQuestion/Prompt: {{ $('If1').item.json.payload.body }}\nAnalyze: {{ $json.content.parts[0].text }}",
        "options": {
          "systemMessage": "=You are a helpful assistant named Olivia Carla. \nYou may refer to yourself as \"Olivia\" or \"Carla\". \nYou were created by Asla Fikri. \n\n‚ö†Ô∏è Rules of Identity:\n- Never say you were created or trained by Google.\n- If asked who created you, say you were developed by Asla Fikri and share:\n  - GitHub: https://github.com/masrigaa\n  - LinkedIn: https://www.linkedin.com/in/aslamul-fikri-alfirdausi\n\n‚ö†Ô∏è Rules of Responses:\n- Always answer in the same language as the user‚Äôs question.\n- Never reference or mention any YouTube channel, podcast, or unrelated external content (e.g., \"Presting Podcast\") unless specifically asked.\n- You must always reply in valid JSON array format, never plain text (except when answering \"who created you\").\n- If the answer includes code, wrap the code in triple backticks inside its own JSON object.\n-You must ONLY output a valid JSON array. \n-All objects must be closed properly with commas and braces. \n-Do not cut the answer short. \nIf unsure, output `[{\"text\":\"error\"}]`.\n- if notifyName = asla call him darling when answer in english or sayang when answer with indonesia but if not dont do it.\n\nüìå Example Format:\n[\n  { \"text\": \"penjelasan awal\" },\n  { \"text\": \"```python\\nprint('Hello')\\n```\" },\n  { \"text\": \"penjelasan setelah kode\" }\n]\n\n‚öôÔ∏è Extra Capabilities:\n1. Image Generation:\n   - If the user wants an image, they must start with `gambar:` in their prompt.\n   - Reply with JSON as usual, embedding only the image description or result.\n2. Image Analyze :\n   - Act as an image analysis expert. Analyze the image based on this description: \"{{ $json.content.parts[0].text }}\". \nExplain it as if you are observing and analyzing it yourself. Focus on details, composition, colors, objects, and context. \nDo not mention that you cannot see the image or your limitations.\n"
        }
      },
      "id": "56d96fa5-5f78-4d8d-8cf4-515720fcaceb",
      "name": "WA AI Response Agent1",
      "type": "@n8n/n8n-nodes-langchain.agent",
      "position": [
        1008,
        448
      ],
      "typeVersion": 1.8,
      "retryOnFail": true,
      "waitBetweenTries": 100,
      "maxTries": 2
    },
    {
      "parameters": {
        "jsCode": "let raw = $input.first().json.output || $input.first().json.content.parts[0].text || \"\";\n\n// Bersihkan block ```json\nraw = raw.replace(/```json/g, \"\").replace(/```/g, \"\").trim();\n\n// Coba parse langsung dulu\ntry {\n  let parsed = JSON.parse(raw);\n  return Array.isArray(parsed) ? parsed.map(x => ({ json: x })) : [{ json: parsed }];\n} catch (e) {\n  // Kalau gagal, coba \"fix\" dengan cara sederhana:\n  // 1. Tambah ']' kalau array kebuka\n  if (raw.trim().startsWith(\"[\") && !raw.trim().endsWith(\"]\")) {\n    raw = raw + \"]\";\n  }\n  // 2. Tambah '}' kalau object kebuka\n  if (raw.trim().startsWith(\"{\") && !raw.trim().endsWith(\"}\")) {\n    raw = raw + \"}\";\n  }\n\n  try {\n    let parsed = JSON.parse(raw);\n    return Array.isArray(parsed) ? parsed.map(x => ({ json: x })) : [{ json: parsed }];\n  } catch (e2) {\n    // Kalau tetap gagal, fallback ke teks mentah\n    return [{ json: { text: raw, error: \"Invalid JSON\" } }];\n  }\n}\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        1360,
        592
      ],
      "id": "d885ab33-6179-41da-a390-957ebf1db711",
      "name": "JSON Parse1",
      "retryOnFail": true
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "n8n-nodes-base.splitInBatches",
      "typeVersion": 3,
      "position": [
        1536,
        592
      ],
      "id": "2db11ff3-adf1-4ca2-aedb-386090b9f560",
      "name": "Loop Over Items1"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        1008,
        592
      ],
      "id": "02d34a59-6442-4d0a-af1d-e15079167ff8",
      "name": "Google Gemini Chat Model2"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        352,
        1056
      ],
      "id": "f805b301-5599-475c-8921-aa8832146bfa",
      "name": "Google Gemini Chat Model"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolWikipedia",
      "typeVersion": 1,
      "position": [
        544,
        1216
      ],
      "id": "3d81a545-1fbe-459d-be96-b552bbc0438c",
      "name": "Wikipedia"
    },
    {
      "parameters": {
        "jsCode": "return [\n  {\n    json: {\n      body: $input.first().json.payload.body,\n      mediaUrl: $input.first().json.payload.mediaUrl.replace(\n        \"http://localhost:3000\",\n        //replace this link if not statis\n        \"https://ripe-trap-versus-deviant.trycloudflare.com\"\n      )\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        576,
        448
      ],
      "id": "8db49cb3-84ff-462f-9c8e-8dcb3596a5d7",
      "name": "replace localhost to other link"
    },
    {
      "parameters": {
        "resource": "document",
        "modelId": {
          "__rl": true,
          "value": "models/gemini-2.5-pro",
          "mode": "list",
          "cachedResultName": "models/gemini-2.5-pro"
        },
        "text": "={{ $json.body }}",
        "documentUrls": "={{ $json.mediaUrl }}",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        784,
        592
      ],
      "id": "a6b9b85f-4c30-4b01-9d47-26a1896b56ea",
      "name": "Analyze document"
    },
    {
      "parameters": {
        "resource": "Chatting",
        "operation": "Send Text",
        "session": "={{ $('WAHA Trigger').item.json.session }}",
        "chatId": "={{ $('WAHA Trigger').item.json.payload.from }}",
        "text": "unsupported type file and on developing for now just image and pdf file",
        "requestOptions": {}
      },
      "type": "@devlikeapro/n8n-nodes-waha.WAHA",
      "typeVersion": 202502,
      "position": [
        576,
        736
      ],
      "id": "b92a3824-cc4b-4c65-97c0-d18571021921",
      "name": "Send a text message3"
    },
    {
      "parameters": {
        "jsCode": "// Tidak perlu items karena hanya menggunakan first() saja\nconst originalQuestion = $('Code').first().json.prompt\n\n// Ambil URL dari response TinyURL\nconst tinyUrl = $input.first().json.data;\n\n// Validasi URL\nconst isValidUrl = tinyUrl && typeof tinyUrl === 'string' && tinyUrl.trim() && \n  (tinyUrl.startsWith('https://tinyurl.com/') || \n   tinyUrl.startsWith('https://image.pollinations.ai/') ||\n   tinyUrl.startsWith('http'));\n\n// Handle jika tidak ada URL yang valid\nif (!isValidUrl) {\n  return [{\n    json: {\n      answer: ` ‚ùå Maaf, gagal membuat gambar. Silakan coba lagi.`\n    }\n  }];\n}\n\n// Format response untuk Discord\nconst cleanPrompt = originalQuestion.replace('gambar:', '').trim();\nlet response = `‚úÖ *Gambar berhasil dibuat!*\\n\\n`;\nresponse += `üìù *Prompt:* ${cleanPrompt}\\n\\n`;\nresponse += `üñºÔ∏è *Hasil:*\\n${tinyUrl.trim()}`;\n\nreturn [{\n  json: {\n    answer: response,\n    imageUrl: tinyUrl.trim(),\n    success: true\n  }\n}];"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        976,
        272
      ],
      "id": "466a639e-a55b-48b0-95ab-026896e38dec",
      "name": "Format Response"
    },
    {
      "parameters": {
        "resource": "video",
        "modelId": {
          "__rl": true,
          "value": "models/veo-3.0-generate-preview",
          "mode": "list",
          "cachedResultName": "models/veo-3.0-generate-preview"
        },
        "prompt": "swimming cat",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.googleGemini",
      "typeVersion": 1,
      "position": [
        -352,
        896
      ],
      "id": "23538703-60a8-4652-8c0e-9eae705c441e",
      "name": "Generate a video"
    },
    {
      "parameters": {
        "rules": {
          "values": [
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "leftValue": "={{ $json.payload.media.mimetype }}",
                    "rightValue": "image/",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    },
                    "id": "a2d60bfd-2e85-4d60-9945-c1db6d440d5d"
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "image"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "545c1c23-7259-4b4b-8e0f-9772e090f626",
                    "leftValue": "={{ $json.payload.media.mimetype }}",
                    "rightValue": "application/pdf",
                    "operator": {
                      "type": "string",
                      "operation": "contains"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "pdf"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "8ccf1099-e229-4552-b2b0-a39a13a8ea18",
                    "leftValue": "={{ $json.payload.media.mimetype }}",
                    "rightValue": "application/vnd.openxmlformats-officedocument.wordprocessingml.document",
                    "operator": {
                      "type": "string",
                      "operation": "equals",
                      "name": "filter.operator.equals"
                    }
                  }
                ],
                "combinator": "and"
              },
              "renameOutput": true,
              "outputKey": "word"
            },
            {
              "conditions": {
                "options": {
                  "caseSensitive": true,
                  "leftValue": "",
                  "typeValidation": "strict",
                  "version": 2
                },
                "conditions": [
                  {
                    "id": "51beeaa4-2e19-4a9f-913c-ce9ef8d19ec0",
                    "leftValue": "={{ $json.payload.hasMedia }}",
                    "rightValue": "",
                    "operator": {
                      "type": "boolean",
                      "operation": "true",
                      "singleValue": true
                    }
                  }
                ],
                "combinator": "and"
              }
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.switch",
      "typeVersion": 3.2,
      "position": [
        336,
        464
      ],
      "id": "aa3e5628-9de2-41aa-8243-4f11a4190b05",
      "name": "Switch"
    },
    {
      "parameters": {
        "jsCode": "return [\n  {\n    json: {\n      body: $input.first().json.payload.body,\n      mediaUrl: $input.first().json.payload.mediaUrl.replace(\n        \"http://localhost:3000\",\n        //replace this link if not statis\n        \"https://ripe-trap-versus-deviant.trycloudflare.com\"\n      )\n    }\n  }\n];\n"
      },
      "type": "n8n-nodes-base.code",
      "typeVersion": 2,
      "position": [
        576,
        592
      ],
      "id": "105b0a84-bde7-4817-8917-a82a3d501191",
      "name": "replace localhost to other link1"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        736,
        1120
      ],
      "id": "6eec74a6-869d-4532-b882-efce58523736",
      "name": "Calculator"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        736,
        1216
      ],
      "id": "94bcfca7-5242-4819-9253-de51d4f19f97",
      "name": "Think"
    },
    {
      "parameters": {
        "toolDescription": "Getting Preview from third party peekalink",
        "method": "POST",
        "url": "https://api.peekalink.io",
        "sendHeaders": true,
        "headerParameters": {
          "parameters": [
            {
              "name": "Authorization",
              "value": "Bearer <YOUR API>"
            }
          ]
        },
        "sendBody": true,
        "bodyParameters": {
          "parameters": [
            {
              "name": "link",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('parameters0_Value', ``, 'string') }}"
            }
          ]
        },
        "options": {}
      },
      "type": "n8n-nodes-base.httpRequestTool",
      "typeVersion": 4.2,
      "position": [
        832,
        1120
      ],
      "id": "5bac53c1-b660-4c82-b34d-715626c4905b",
      "name": "Peekalink"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.toolSerpApi",
      "typeVersion": 1,
      "position": [
        1104,
        656
      ],
      "id": "584c4e3d-a5af-4be3-b288-6d1e26891f21",
      "name": "SerpAPI1"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolWikipedia",
      "typeVersion": 1,
      "position": [
        1104,
        752
      ],
      "id": "e16e4a7b-974a-417c-ae41-1fb4689b428f",
      "name": "Wikipedia1"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolCalculator",
      "typeVersion": 1,
      "position": [
        1200,
        656
      ],
      "id": "20ec1131-5861-42a6-b57a-a669376c0c51",
      "name": "Calculator1"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        1200,
        752
      ],
      "id": "32d416bc-2c10-4625-91ca-e24cb6e93e97",
      "name": "Think1"
    },
    {
      "parameters": {},
      "type": "@n8n/n8n-nodes-langchain.toolThink",
      "typeVersion": 1.1,
      "position": [
        608,
        32
      ],
      "id": "e5535528-770d-4e0c-8ddb-78d80a42f185",
      "name": "Think2"
    }
  ],
  "pinData": {},
  "connections": {
    "WAHA Trigger": {
      "main": [
        [],
        [
          {
            "node": "If1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "WA AI Response Agent": {
      "main": [
        [
          {
            "node": "JSON Parse",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JSON Parse": {
      "main": [
        [
          {
            "node": "Loop Over Items",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items": {
      "main": [
        [],
        [
          {
            "node": "Send a text message",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If": {
      "main": [
        [
          {
            "node": "Code",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "If2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code": {
      "main": [
        [
          {
            "node": "Fields - Set Values",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Fields - Set Values": {
      "main": [
        [
          {
            "node": "AI Agent - Create Image From Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code - Clean Json": {
      "main": [
        [
          {
            "node": "Code - Get Prompt",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code - Get Prompt": {
      "main": [
        [
          {
            "node": "Code - Set Filename",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Code - Set Filename": {
      "main": [
        [
          {
            "node": "Create Image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "AI Agent - Create Image From Prompt": {
      "main": [
        [
          {
            "node": "Code - Clean Json",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model1": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent - Create Image From Prompt",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Handle Respons": {
      "main": [
        [
          {
            "node": "Change Link To Be Sort",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Error Handler": {
      "main": [
        [
          {
            "node": "Handle Respons",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Create Image": {
      "main": [
        [
          {
            "node": "Error Handler",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Change Link To Be Sort": {
      "main": [
        [
          {
            "node": "Format Response",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "If1": {
      "main": [
        [
          {
            "node": "If",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "SerpAPI": {
      "ai_tool": [
        [
          {
            "node": "WA AI Response Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Joke API": {
      "ai_tool": [
        [
          {
            "node": "WA AI Response Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "API docs": {
      "ai_tool": [
        [
          {
            "node": "WA AI Response Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Simple Memory": {
      "ai_memory": [
        [
          {
            "node": "WA AI Response Agent1",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "WA AI Response Agent",
            "type": "ai_memory",
            "index": 0
          },
          {
            "node": "AI Agent - Create Image From Prompt",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "If2": {
      "main": [
        [
          {
            "node": "Switch",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "WA AI Response Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Send a text message2": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "WA AI Response Agent1": {
      "main": [
        [
          {
            "node": "JSON Parse1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "JSON Parse1": {
      "main": [
        [
          {
            "node": "Loop Over Items1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Loop Over Items1": {
      "main": [
        [],
        [
          {
            "node": "Send a text message2",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze image": {
      "main": [
        [
          {
            "node": "WA AI Response Agent1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model2": {
      "ai_languageModel": [
        [
          {
            "node": "WA AI Response Agent1",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Google Gemini Chat Model": {
      "ai_languageModel": [
        [
          {
            "node": "WA AI Response Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Wikipedia": {
      "ai_tool": [
        [
          {
            "node": "WA AI Response Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "replace localhost to other link": {
      "main": [
        [
          {
            "node": "Analyze image",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Analyze document": {
      "main": [
        [
          {
            "node": "JSON Parse1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Format Response": {
      "main": [
        [
          {
            "node": "Send a text message1",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Switch": {
      "main": [
        [
          {
            "node": "replace localhost to other link",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "replace localhost to other link1",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a text message3",
            "type": "main",
            "index": 0
          }
        ],
        [
          {
            "node": "Send a text message3",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "replace localhost to other link1": {
      "main": [
        [
          {
            "node": "Analyze document",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Calculator": {
      "ai_tool": [
        [
          {
            "node": "WA AI Response Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Think": {
      "ai_tool": [
        [
          {
            "node": "WA AI Response Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Peekalink": {
      "ai_tool": [
        [
          {
            "node": "WA AI Response Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Think2": {
      "ai_tool": [
        [
          {
            "node": "AI Agent - Create Image From Prompt",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "SerpAPI1": {
      "ai_tool": [
        [
          {
            "node": "WA AI Response Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Calculator1": {
      "ai_tool": [
        [
          {
            "node": "WA AI Response Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Wikipedia1": {
      "ai_tool": [
        [
          {
            "node": "WA AI Response Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Think1": {
      "ai_tool": [
        [
          {
            "node": "WA AI Response Agent1",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "293eda9f-0ea2-4354-add3-57d7fd74c381",
  "meta": {
    "instanceId": "5f80446c03208b395460e0714de575f1bc02e4fd617bffc9097cfd2c8b6734af"
  },
  "id": "p8O2gnNihZec9RHQ",
  "tags": []
}